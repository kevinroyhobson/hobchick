function disableDrawingPeople(){kevinModeActive=false;danielleModeActive=false}function enableDrawingKevin(){kevinModeActive=true;danielleModeActive=false}function enableDrawingDanielle(){kevinModeActive=false;danielleModeActive=true}function initKevinMaze(){var e=$(".maze-wrapper");var t=$(".footer");canvas=$(".maze-canvas")[0];context=canvas.getContext("2d");drawOhioMaze();mazeHeight=$(".maze-wrapper").height();mazeWidth=Math.round(mazeHeight/1.093495935);canvasScaleFactor=mazeHeight/807;kevWidth=defaultKevWidth*canvasScaleFactor;kevHeight=defaultKevHeight*canvasScaleFactor;if(debugMode){defaultOhioYPosition=400;defaultOhioXPosition=650}kevinXPosition=Math.round(defaultOhioXPosition*canvasScaleFactor);kevinYPosition=Math.round(defaultOhioYPosition*canvasScaleFactor);var n=Math.round(ohioFinishXPosition*canvasScaleFactor);var r=Math.round(ohioFinishYPosition*canvasScaleFactor);e.css("padding-top",($(window).height()-mazeHeight-t.outerHeight())/2);canvas.width=mazeWidth;canvas.height=mazeHeight;constructWinningSet(n,r);setUpKeyListeners()}function initDanielleMaze(){var e=$(".maze-wrapper");var t=$(".footer");canvas=$(".maze-canvas")[0];context=canvas.getContext("2d");drawNewYorkMaze();mazeHeight=$(".maze-wrapper").height();mazeWidth=Math.round(mazeHeight*1.31061599);canvasScaleFactor=mazeHeight/763;kevWidth=defaultDanielleWidth*canvasScaleFactor;kevHeight=defaultDanielleHeight*canvasScaleFactor;if(debugMode){defaultNewYorkXPosition=100;defaultNewYorkYPosition=400}kevinXPosition=Math.round(defaultNewYorkXPosition*canvasScaleFactor);kevinYPosition=Math.round(defaultNewYorkYPosition*canvasScaleFactor);var n=Math.round(newYorkFinishXPosition*canvasScaleFactor);var r=Math.round(newYorkFinishYPosition*canvasScaleFactor);e.css("padding-top",($(window).height()-mazeHeight-t.outerHeight())/2);canvas.width=mazeWidth;canvas.height=mazeHeight;constructWinningSet(n,r);setUpKeyListeners()}function setUpKeyListeners(){var e=new window.keypress.Listener;e.register_combo({keys:"up",on_keydown:function(){currentYSpeedKeyboard=-1*speedConstant},on_keyup:function(){currentYSpeedKeyboard=0}});e.register_combo({keys:"down",on_keydown:function(){currentYSpeedKeyboard=speedConstant},on_keyup:function(){currentYSpeedKeyboard=0}});e.register_combo({keys:"left",on_keydown:function(){currentXSpeedKeyboard=-1*speedConstant},on_keyup:function(){currentXSpeedKeyboard=0}});e.register_combo({keys:"right",on_keydown:function(){currentXSpeedKeyboard=speedConstant},on_keyup:function(){currentXSpeedKeyboard=0}});if(debugMode){e.register_combo({keys:"d",on_keydown:function(){danielleWins()}});e.register_combo({keys:"k",on_keydown:function(){kevinWins()}})}}function setUpMouseListener(){$("body").mousemove(function(e){if(previousMouseX==undefined&&previousMouseY==undefined){previousMouseX=e.pageX;previousMouseY=e.pageY}if(e.pageX>previousMouseX){currentXSpeedMouse=speedConstant}else if(e.pageX<previousMouseX){currentXSpeedMouse=-1*speedConstant}else{currentXSpeedMouse=0}if(e.pageY>previousMouseY){currentYSpeedMouse=speedConstant}else if(e.pageY<previousMouseY){currentYSpeedMouse=-1*speedConstant}else{currentYSpeedMouse=0}})}function handleMovement(){var e=kevinXPosition+currentXSpeedKeyboard+currentXSpeedMouse;var t=kevinYPosition+currentYSpeedKeyboard+currentYSpeedMouse;if((currentXSpeedKeyboard!=0||currentXSpeedMouse!=0)&&canMoveTo(e,kevinYPosition)){kevinXPosition=e}if((currentYSpeedKeyboard!=0||currentYSpeedMouse!=0)&&canMoveTo(kevinXPosition,t)){kevinYPosition=t}currentXSpeedMouse=0;currentYSpeedMouse=0;setTimeout(function(){handleMovement()},50)}function drawMaze(){if(kevinModeActive){drawOhioMaze()}if(danielleModeActive){drawNewYorkMaze()}}function drawOhioMaze(){var e=new Image;e.onload=function(){context.drawImage(e,0,0,mazeWidth,mazeHeight)};e.src="/static/img/how/ohio-maze.jpg"}function drawNewYorkMaze(){var e=new Image;e.onload=function(){context.drawImage(e,0,0,mazeWidth,mazeHeight)};e.src="/static/img/how/new-york-maze.jpg"}function drawKev(){if(kevinModeActive||danielleModeActive){if(!debugMode){drawMaze()}kevImage=new Image;kevImage.onload=function(){context.drawImage(kevImage,kevinXPosition,kevinYPosition,kevWidth,kevHeight)};if(kevinModeActive){kevImage.src="/static/img/how/kevin-head-small.png"}else if(danielleModeActive){kevImage.src="/static/img/how/danielle-head-small.png"}}setTimeout(function(){drawKev()},50)}function makeWhite(e,t,n,r){context.beginPath();context.rect(e,t,n,r);context.closePath();context.fillStyle="white";context.fill()}function makeGreen(e,t,n,r){context.beginPath();context.rect(e,t,n,r);context.closePath();context.fillStyle="green";context.fill()}function makeRed(e,t,n,r){context.beginPath();context.rect(e,t,n,r);context.closePath();context.fillStyle="red";context.fill()}function constructBoundarySet(){boundarySet={};var e=context.getImageData(0,0,mazeWidth,mazeHeight);var t=e.data;if(pixelIsBlack(0,t)){setTimeout(function(){constructBoundarySet()},10);return}for(var n=0;n<4*mazeWidth*mazeHeight;n+=4){if(pixelIsBlack(n,t)){var r=n/4;var i=Math.floor(r/mazeWidth);var s=r-i*mazeWidth;boundarySet[s+","+i]=true;if(debugMode){makeGreen(s,i,1,1)}}}}function pixelIsBlack(e,t){return t[e]<100&&t[e+1]<100&&t[e+2]<100}function canMoveTo(e,t){var n=1;var r=t+Math.floor(3/8*kevHeight);var i=r+Math.floor(kevHeight/4);var s=e+Math.floor(3/8*kevWidth);var o=s+Math.floor(kevWidth/4);if(debugMode){makeWhite(s,r,Math.floor(kevWidth/2),Math.floor(kevHeight/2))}if(e>=0&&e<=mazeWidth-kevWidth/2&&t>=0&&t<=mazeHeight-kevHeight/2){for(var u=s;u<o;u++){for(var a=r;a<i;a++){var f=u+","+a;if(boundarySet[f]==true){return 0}if(winningSet[f]==true){if(danielleModeActive){danielleWins()}else{kevinWins()}}else{}}}}else{n=0}return n}function constructWinningSet(e,t){winningSet={};setTimeout(function(){for(var n=e-2;n<=e+2;n++){for(var r=t-2;r<=t+2;r++){winningSet[n+","+r]=true;if(debugMode){makeRed(n,r,1,1)}}}},1e3)}function danielleWins(){$(".danielle-wins").show();ga("send","event","maze","danielle-complete","duration",getElapsedSeconds())}function kevinWins(){$(".kevin-wins").show();ga("send","event","maze","kevin-complete","duration",getElapsedSeconds())}function getElapsedSeconds(){var e=new Date;return(e.getTime()-timeStarted.getTime())/1e3}var canvas;var context;var canvasScaleFactor;var defaultOhioYPosition=665;var defaultOhioXPosition=65;var ohioFinishXPosition=700;var ohioFinishYPosition=390;var defaultNewYorkXPosition=780;var defaultNewYorkYPosition=640;var newYorkFinishXPosition=20;var newYorkFinishYPosition=500;var kevinXPosition;var kevinYPosition;var mazeWidth;var mazeHeight;var defaultKevWidth=25;var defaultKevHeight=37;var defaultDanielleWidth=40;var defaultDanielleHeight=43;var kevWidth;var kevHeight;var kevImage;var currentXSpeedKeyboard=0;var currentYSpeedKeyboard=0;var currentXSpeedMouse=0;var currentYSpeedMouse=0;var speedConstant=6;var boundarySet;var winningSet;var kevinModeActive=false;var danielleModeActive=false;var previousMouseX;var previousMouseY;var debugMode=false;var timeStarted;$(function(){$(".kevin-head").click(function(){$(".selection").hide();$(".kevin-maze-instructions").show("fast");disableDrawingPeople();initKevinMaze();setTimeout(function(){constructBoundarySet();enableDrawingKevin()},100);ga("send","event","maze","kevin-start");timeStarted=new Date});$(".danielle-head").click(function(){$(".selection").hide();$(".danielle-maze-instructions").show("fast");disableDrawingPeople();initDanielleMaze();setTimeout(function(){constructBoundarySet();enableDrawingDanielle()},100);ga("send","event","maze","danielle-start");timeStarted=new Date});drawKev();handleMovement()})